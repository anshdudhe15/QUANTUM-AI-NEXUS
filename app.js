// Quantum-Blockchain AI Nexus - Advanced JavaScript Functionality

class QuantumAINexus {
  constructor() {
    this.data = {
      quantumModels: [
        {
          id: "qm-001",
          name: "Quantum-Secured Medical AI",
          version: "v3.2.1-QS",
          owner: "Dr. Elena Vasquez",
          accuracy: 98.7,
          quantumSecurityLevel: "Post-Quantum",
          deepfakeAuthenticity: 99.97,
          carbonFootprint: -1.2,
          esgScore: 97,
          status: "Production",
          parameters: 12500000,
          framework: "TensorFlow Quantum",
          domain: "Healthcare",
          deployedNetworks: ["Ethereum-Q", "Polkadot-Q", "Solana-Q"]
        },
        {
          id: "qm-002", 
          name: "Autonomous Vehicle Vision System",
          version: "v5.1.0-QS",
          owner: "Tesla AI Collective",
          accuracy: 99.94,
          quantumSecurityLevel: "Quantum-Resistant",
          deepfakeAuthenticity: 99.99,
          carbonFootprint: -8.7,
          esgScore: 94,
          status: "Testing",
          parameters: 45000000,
          framework: "PyTorch Quantum",
          domain: "Automotive",
          deployedNetworks: ["Avalanche-Q", "Cosmos-Q"]
        },
        {
          id: "qm-003",
          name: "Global Climate Prediction Model",
          version: "v4.3.2-QS", 
          owner: "Prof. Amara Singh",
          accuracy: 96.8,
          quantumSecurityLevel: "Quantum-Native",
          deepfakeAuthenticity: 99.95,
          carbonFootprint: -15.3,
          esgScore: 100,
          status: "Production",
          parameters: 87000000,
          framework: "Quantum TensorFlow",
          domain: "Climate Science",
          deployedNetworks: ["All Networks"]
        }
      ],
      quantumKPIs: {
        totalQuantumModels: 847,
        quantumProtectedDeployments: 756,
        postQuantumTransactions: 187530,
        deepfakeDetectionsBlocked: 12,
        carbonCreditsEarned: 234.5,
        esgComplianceScore: 98.2,
        quantumThreatLevel: "Minimal",
        aiGovernanceAgentsActive: 15,
        globalRegulatoryCompliance: 99.1,
        crossChainOperations: 45670,
        averageSecurityLevel: 97.3,
        totalCarbonSaved: 1247.8,
        biometricVerificationSuccess: 99.89,
        systemUptime: 99.95
      },
      aiAgents: [
        {
          id: "qa-001",
          name: "Quantum Security Guardian",
          type: "Security",
          status: "Active",
          capabilities: ["Threat Detection", "Post-Quantum Crypto", "Anomaly Analysis"],
          connectedModels: 234,
          tasksCompleted: 15670,
          successRate: 98.7,
          lastActivity: "2s ago"
        },
        {
          id: "qa-002", 
          name: "Carbon Optimizer Prime",
          type: "Sustainability",
          status: "Active",
          capabilities: ["Carbon Tracking", "Energy Optimization", "ESG Monitoring"],
          connectedModels: 345,
          tasksCompleted: 23450,
          successRate: 97.2,
          lastActivity: "8s ago"
        },
        {
          id: "qa-003",
          name: "Compliance Enforcer",
          type: "Regulatory",
          status: "Active", 
          capabilities: ["GDPR Compliance", "AI Act Monitoring", "Bias Detection"],
          connectedModels: 189,
          tasksCompleted: 8760,
          successRate: 99.1,
          lastActivity: "15s ago"
        },
        {
          id: "qa-004",
          name: "Deepfake Hunter",
          type: "Authenticity",
          status: "Active",
          capabilities: ["Video Analysis", "Audio Verification", "3D Model Authentication"],
          connectedModels: 567,
          tasksCompleted: 45230,
          successRate: 99.97,
          lastActivity: "1s ago"
        }
      ],
      quantumNetworks: [
        {
          name: "Ethereum-Quantum",
          status: "Quantum-Secure",
          postQuantumAlgorithms: ["Kyber", "Dilithium", "Falcon"],
          blockHeight: 19750347,
          tps: 50000,
          models: 234,
          gasPrice: "12 qGwei",
          securityLevel: "Post-Quantum"
        },
        {
          name: "Polkadot-Quantum", 
          status: "Quantum-Native",
          postQuantumAlgorithms: ["SPHINCS+", "Rainbow", "Picnic"],
          blockHeight: 67890123,
          tps: 120000,
          models: 189,
          gasPrice: "8 qGwei",
          securityLevel: "Quantum-Enhanced"
        },
        {
          name: "Solana-Quantum",
          status: "Quantum-Resistant", 
          postQuantumAlgorithms: ["FrodoKEM", "SIKE", "NewHope"],
          blockHeight: 89123456,
          tps: 200000,
          models: 145,
          gasPrice: "0.002 qSOL",
          securityLevel: "Quantum-Ready"
        }
      ],
      intelligenceStream: [
        {
          id: 1,
          type: "security",
          icon: "🛡️",
          title: "Quantum Threat Neutralized", 
          description: "Advanced persistent quantum attack blocked by post-quantum defenses",
          timestamp: "2 minutes ago",
          priority: "high",
          source: "Quantum Security Guardian"
        },
        {
          id: 2,
          type: "regulatory",
          icon: "📋",
          title: "EU AI Act Compliance Updated",
          description: "New quantum cryptography requirements automatically integrated",
          timestamp: "8 minutes ago", 
          priority: "normal",
          source: "Compliance Enforcer"
        },
        {
          id: 3,
          type: "carbon",
          icon: "🌱",
          title: "Carbon Negative Milestone",
          description: "Climate model achieved record -15.3 tons CO2 impact reduction", 
          timestamp: "15 minutes ago",
          priority: "normal",
          source: "Carbon Optimizer Prime"
        },
        {
          id: 4,
          type: "deepfake",
          icon: "🔍", 
          title: "Sophisticated Deepfakes Blocked",
          description: "23 advanced deepfake attempts detected with 99.97% accuracy",
          timestamp: "32 minutes ago",
          priority: "normal",
          source: "Deepfake Hunter"
        }
      ],
      chartData: {
        quantumPerformance: {
          labels: ["00:00", "04:00", "08:00", "12:00", "16:00", "20:00", "24:00"],
          security: [97.2, 97.8, 98.1, 97.9, 98.5, 98.3, 97.9],
          performance: [94.1, 95.2, 96.7, 95.8, 97.2, 96.5, 95.9],
          compliance: [98.9, 99.1, 99.2, 98.7, 99.4, 99.0, 98.8]
        },
        deepfakeDetection: {
          categories: ["Video", "Audio", "Image", "Text", "3D Models"],
          detected: [156, 43, 35, 0, 12], 
          accuracy: [99.97, 99.95, 99.98, 100, 99.92]
        },
        carbonFootprint: {
          months: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          carbonSavings: [-5.2, -8.7, -12.1, -15.3, -18.9, -23.4],
          renewableEnergy: [65, 72, 78, 83, 87, 92],
          esgScore: [89, 91, 94, 96, 98, 100]
        },
        networkActivity: {
          networks: ["Ethereum-Q", "Polkadot-Q", "Solana-Q", "Avalanche-Q", "Cosmos-Q"],
          transactions: [45670, 23450, 67890, 34560, 12340],
          models: [234, 189, 145, 123, 89]
        }
      }
    };
    
    this.charts = {};
    this.currentSection = 'command';
    this.notifications = [];
    this.currentFilter = 'all';
    this.isDarkTheme = true;
    
    this.init();
  }

  init() {
    this.setupNavigation();
    this.setupEventListeners();
    this.initializeCharts();
    this.populateIntelligenceStream();
    this.populateNetworkStatus();
    this.populateAgents();
    this.populateModels();
    this.animateKPIs();
    this.startRealTimeUpdates();
    this.createProvenanceNodes();
    this.showNotification('System Initialized', 'Quantum AI Nexus is fully operational', 'success');
  }

  // Navigation System
  setupNavigation() {
    const navButtons = document.querySelectorAll('.nav-btn');
    const sections = document.querySelectorAll('.dashboard-section');

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetSection = btn.dataset.section;
        this.switchSection(targetSection);
        
        // Update active states
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });
  }

  switchSection(sectionId) {
    const sections = document.querySelectorAll('.dashboard-section');
    sections.forEach(section => {
      section.classList.remove('active');
    });
    
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
      targetSection.classList.add('active');
      this.currentSection = sectionId;
      
      // Trigger section-specific updates
      this.updateSection(sectionId);
    }
  }

  updateSection(sectionId) {
    switch(sectionId) {
      case 'security':
        this.updateDeepfakeChart();
        break;
      case 'carbon':
        this.updateCarbonChart();
        break;
      case 'agents':
        this.updateAgentNetwork();
        break;
      case 'registry':
        this.updateModelComparison();
        break;
    }
  }

  // Event Listeners
  setupEventListeners() {
    // Voice Command Modal
    const voiceBtn = document.querySelector('.voice-btn');
    const voiceModal = document.getElementById('voiceModal');
    const modalClose = document.querySelector('.modal-close');
    const modalOverlay = document.querySelector('.modal-overlay');

    voiceBtn?.addEventListener('click', () => {
      voiceModal.classList.remove('hidden');
      this.startVoiceListening();
    });

    modalClose?.addEventListener('click', () => {
      voiceModal.classList.add('hidden');
      this.stopVoiceListening();
    });

    modalOverlay?.addEventListener('click', () => {
      voiceModal.classList.add('hidden');
      this.stopVoiceListening();
    });

    // Theme Toggle
    const themeBtn = document.querySelector('.theme-btn');
    themeBtn?.addEventListener('click', () => {
      this.toggleTheme();
    });

    // Search Functionality
    const searchInput = document.querySelector('.search-input');
    searchInput?.addEventListener('input', (e) => {
      this.filterModels(e.target.value);
    });

    // Stream Filters
    const filterBtns = document.querySelectorAll('.filter-btn');
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        this.currentFilter = btn.dataset.filter;
        this.filterIntelligenceStream();
      });
    });

    // Chart Time Controls
    const chartBtns = document.querySelectorAll('.chart-btn');
    chartBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const parent = btn.closest('.chart-controls');
        if (parent) {
          parent.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          this.updateChartTimeRange(btn.textContent);
        }
      });
    });

    // Voice Suggestions
    const suggestionBtns = document.querySelectorAll('.suggestion-btn');
    suggestionBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        this.processVoiceCommand(btn.textContent.replace(/"/g, ''));
        voiceModal.classList.add('hidden');
      });
    });

    // Provenance Timeline
    const timelineSlider = document.querySelector('.timeline-scrubber');
    timelineSlider?.addEventListener('input', (e) => {
      this.updateProvenanceTimeline(e.target.value);
    });
  }

  // KPI Animation
  animateKPIs() {
    const kpiValues = document.querySelectorAll('.kpi-value');
    
    kpiValues.forEach(element => {
      const targetValue = parseFloat(element.dataset.value);
      const isNegative = targetValue < 0;
      const absoluteTarget = Math.abs(targetValue);
      
      let currentValue = 0;
      const increment = absoluteTarget / 100;
      const timer = setInterval(() => {
        currentValue += increment;
        if (currentValue >= absoluteTarget) {
          currentValue = absoluteTarget;
          clearInterval(timer);
        }
        
        const displayValue = isNegative ? -currentValue : currentValue;
        
        // Format based on the original value
        if (element.dataset.value.includes('.')) {
          element.textContent = displayValue.toFixed(1);
        } else {
          element.textContent = Math.floor(displayValue).toLocaleString();
        }
      }, 20);
    });
  }

  // Chart Initialization
  initializeCharts() {
    this.initPerformanceChart();
    setTimeout(() => {
      this.initDeepfakeChart();
      this.initCarbonChart();
      this.initAgentNetworkChart();
      this.initModelComparisonChart();
    }, 100);
  }

  initPerformanceChart() {
    const ctx = document.getElementById('performanceChart');
    if (!ctx) return;

    this.charts.performance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: this.data.chartData.quantumPerformance.labels,
        datasets: [
          {
            label: 'Security Level',
            data: this.data.chartData.quantumPerformance.security,
            borderColor: '#1FB8CD',
            backgroundColor: 'rgba(31, 184, 205, 0.1)',
            fill: true,
            tension: 0.4
          },
          {
            label: 'Performance Score',
            data: this.data.chartData.quantumPerformance.performance,
            borderColor: '#FFC185',
            backgroundColor: 'rgba(255, 193, 133, 0.1)',
            fill: true,
            tension: 0.4
          },
          {
            label: 'Compliance',
            data: this.data.chartData.quantumPerformance.compliance,
            borderColor: '#B4413C',
            backgroundColor: 'rgba(180, 65, 60, 0.1)',
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#f5f5f5'
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#a7a9a9' },
            grid: { color: 'rgba(167, 169, 169, 0.1)' }
          },
          y: {
            ticks: { color: '#a7a9a9' },
            grid: { color: 'rgba(167, 169, 169, 0.1)' },
            min: 90,
            max: 100
          }
        }
      }
    });
  }

  initDeepfakeChart() {
    const ctx = document.getElementById('deepfakeChart');
    if (!ctx) return;

    this.charts.deepfake = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: this.data.chartData.deepfakeDetection.categories,
        datasets: [{
          data: this.data.chartData.deepfakeDetection.detected,
          backgroundColor: ['#1FB8CD', '#FFC185', '#B4413C', '#ECEBD5', '#5D878F'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#f5f5f5',
              padding: 20
            }
          }
        }
      }
    });
  }

  initCarbonChart() {
    const ctx = document.getElementById('carbonChart');
    if (!ctx) return;

    this.charts.carbon = new Chart(ctx, {
      type: 'line',
      data: {
        labels: this.data.chartData.carbonFootprint.months,
        datasets: [
          {
            label: 'Carbon Savings (tons)',
            data: this.data.chartData.carbonFootprint.carbonSavings,
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            yAxisID: 'y'
          },
          {
            label: 'Renewable Energy (%)',
            data: this.data.chartData.carbonFootprint.renewableEnergy,
            borderColor: '#1FB8CD',
            backgroundColor: 'rgba(31, 184, 205, 0.1)',
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        plugins: {
          legend: {
            labels: {
              color: '#f5f5f5'
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#a7a9a9' },
            grid: { color: 'rgba(167, 169, 169, 0.1)' }
          },
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            ticks: { color: '#a7a9a9' },
            grid: { color: 'rgba(167, 169, 169, 0.1)' }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            ticks: { color: '#a7a9a9' },
            grid: { drawOnChartArea: false }
          }
        }
      }
    });
  }

  initAgentNetworkChart() {
    const ctx = document.getElementById('agentNetworkChart');
    if (!ctx) return;

    this.charts.agentNetwork = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['Security', 'Compliance', 'Carbon', 'Performance', 'Innovation'],
        datasets: [{
          label: 'Agent Capabilities',
          data: [98, 97, 95, 96, 94],
          borderColor: '#7c3aed',
          backgroundColor: 'rgba(124, 58, 237, 0.2)',
          pointBackgroundColor: '#7c3aed'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#f5f5f5'
            }
          }
        },
        scales: {
          r: {
            angleLines: { color: 'rgba(167, 169, 169, 0.2)' },
            grid: { color: 'rgba(167, 169, 169, 0.2)' },
            pointLabels: { color: '#a7a9a9' },
            ticks: { color: '#a7a9a9', backdropColor: 'transparent' }
          }
        }
      }
    });
  }

  initModelComparisonChart() {
    const ctx = document.getElementById('modelComparisonChart');
    if (!ctx) return;

    this.charts.modelComparison = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Accuracy', 'Security', 'Carbon Impact', 'ESG Score'],
        datasets: [
          {
            label: 'Medical AI',
            data: [98.7, 95, 88, 97],
            backgroundColor: '#1FB8CD'
          },
          {
            label: 'Vehicle Vision',
            data: [99.94, 92, 95, 94],
            backgroundColor: '#FFC185'
          },
          {
            label: 'Climate Model',
            data: [96.8, 98, 100, 100],
            backgroundColor: '#B4413C'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#f5f5f5'
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#a7a9a9' },
            grid: { color: 'rgba(167, 169, 169, 0.1)' }
          },
          y: {
            ticks: { color: '#a7a9a9' },
            grid: { color: 'rgba(167, 169, 169, 0.1)' },
            min: 80,
            max: 100
          }
        }
      }
    });
  }

  // Intelligence Stream
  populateIntelligenceStream() {
    const container = document.getElementById('streamItems');
    if (!container) return;

    container.innerHTML = '';
    
    this.data.intelligenceStream.forEach(item => {
      const streamItem = document.createElement('div');
      streamItem.className = `stream-item priority-${item.priority}`;
      streamItem.dataset.type = item.type;
      
      streamItem.innerHTML = `
        <div class="stream-icon">${item.icon}</div>
        <div class="stream-content">
          <div class="stream-title">${item.title}</div>
          <div class="stream-description">${item.description}</div>
          <div class="stream-meta">
            <span>${item.timestamp}</span>
            <span>${item.source}</span>
          </div>
        </div>
      `;
      
      container.appendChild(streamItem);
    });
  }

  filterIntelligenceStream() {
    const items = document.querySelectorAll('.stream-item');
    items.forEach(item => {
      if (this.currentFilter === 'all' || item.dataset.type === this.currentFilter) {
        item.style.display = 'flex';
      } else {
        item.style.display = 'none';
      }
    });
  }

  // Network Status
  populateNetworkStatus() {
    const container = document.getElementById('networkGrid');
    if (!container) return;

    container.innerHTML = '';
    
    this.data.quantumNetworks.forEach(network => {
      const networkCard = document.createElement('div');
      networkCard.className = 'network-card';
      
      networkCard.innerHTML = `
        <div class="network-header">
          <div class="network-name">${network.name}</div>
          <div class="network-status-indicator quantum-secure">${network.status}</div>
        </div>
        <div class="network-metrics">
          <div class="network-metric">
            <span class="network-metric-label">Block Height</span>
            <span class="network-metric-value">${network.blockHeight.toLocaleString()}</span>
          </div>
          <div class="network-metric">
            <span class="network-metric-label">TPS</span>
            <span class="network-metric-value">${network.tps.toLocaleString()}</span>
          </div>
          <div class="network-metric">
            <span class="network-metric-label">Models</span>
            <span class="network-metric-value">${network.models}</span>
          </div>
          <div class="network-metric">
            <span class="network-metric-label">Gas Price</span>
            <span class="network-metric-value">${network.gasPrice}</span>
          </div>
        </div>
      `;
      
      container.appendChild(networkCard);
    });
  }

  // AI Agents
  populateAgents() {
    const container = document.getElementById('agentsGrid');
    if (!container) return;

    container.innerHTML = '';
    
    this.data.aiAgents.forEach(agent => {
      const agentCard = document.createElement('div');
      agentCard.className = 'agent-card';
      
      const capabilityTags = agent.capabilities.map(cap => 
        `<span class="capability-tag">${cap}</span>`
      ).join('');
      
      agentCard.innerHTML = `
        <div class="agent-header">
          <div class="agent-name">${agent.name}</div>
          <div class="agent-status">
            <div class="agent-status-dot"></div>
            <span>${agent.status}</span>
          </div>
        </div>
        <div class="agent-type">${agent.type}</div>
        <div class="agent-capabilities">
          <h4>Capabilities</h4>
          <div class="capability-tags">${capabilityTags}</div>
        </div>
        <div class="agent-metrics">
          <div class="agent-metric">
            <span class="agent-metric-label">Connected Models</span>
            <span class="agent-metric-value">${agent.connectedModels}</span>
          </div>
          <div class="agent-metric">
            <span class="agent-metric-label">Tasks Completed</span>
            <span class="agent-metric-value">${agent.tasksCompleted.toLocaleString()}</span>
          </div>
          <div class="agent-metric">
            <span class="agent-metric-label">Success Rate</span>
            <span class="agent-metric-value">${agent.successRate}%</span>
          </div>
          <div class="agent-metric">
            <span class="agent-metric-label">Last Activity</span>
            <span class="agent-metric-value">${agent.lastActivity}</span>
          </div>
        </div>
      `;
      
      container.appendChild(agentCard);
    });
  }

  // Models Registry
  populateModels() {
    const container = document.getElementById('modelsGrid');
    if (!container) return;

    container.innerHTML = '';
    
    this.data.quantumModels.forEach(model => {
      const modelCard = document.createElement('div');
      modelCard.className = 'model-card';
      
      const networkChips = Array.isArray(model.deployedNetworks) 
        ? model.deployedNetworks.map(network => 
            `<span class="network-chip">${network}</span>`
          ).join('')
        : `<span class="network-chip">${model.deployedNetworks}</span>`;
      
      const statusClass = model.status.toLowerCase();
      const carbonClass = model.carbonFootprint < 0 ? 'positive' : 'negative';
      
      modelCard.innerHTML = `
        <div class="model-header">
          <div class="model-name">${model.name}</div>
          <div class="model-version">${model.version}</div>
        </div>
        <div class="model-metrics">
          <div class="model-metric">
            <div class="model-metric-value">${model.accuracy}%</div>
            <div class="model-metric-label">Accuracy</div>
          </div>
          <div class="model-metric">
            <div class="model-metric-value">${model.esgScore}</div>
            <div class="model-metric-label">ESG Score</div>
          </div>
          <div class="model-metric">
            <div class="model-metric-value">${model.carbonFootprint}</div>
            <div class="model-metric-label">Carbon Impact</div>
          </div>
          <div class="model-metric">
            <div class="model-metric-value">${model.deepfakeAuthenticity}%</div>
            <div class="model-metric-label">Authenticity</div>
          </div>
        </div>
        <div class="model-tags">
          <span class="model-tag">${model.quantumSecurityLevel}</span>
          <span class="model-tag">${model.domain}</span>
          <span class="model-tag">${model.framework}</span>
          <span class="model-tag">${model.status}</span>
        </div>
        <div class="model-networks">
          <div class="model-networks-label">Deployed Networks:</div>
          <div class="network-chips">${networkChips}</div>
        </div>
      `;
      
      container.appendChild(modelCard);
    });
  }

  filterModels(searchTerm) {
    const modelCards = document.querySelectorAll('.model-card');
    modelCards.forEach(card => {
      const modelName = card.querySelector('.model-name').textContent.toLowerCase();
      const modelDomain = card.querySelector('.model-tag').textContent.toLowerCase();
      
      if (modelName.includes(searchTerm.toLowerCase()) || 
          modelDomain.includes(searchTerm.toLowerCase())) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  }

  // Provenance Nodes
  createProvenanceNodes() {
    const container = document.getElementById('provenanceNodes');
    if (!container) return;

    container.innerHTML = '';
    
    // Create sample provenance nodes
    const nodes = [
      { id: 1, x: 20, y: 20, model: 'Genesis Model', version: 'v1.0' },
      { id: 2, x: 60, y: 40, model: 'Enhanced Model', version: 'v2.1' },
      { id: 3, x: 40, y: 70, model: 'Quantum Model', version: 'v3.2' },
      { id: 4, x: 80, y: 80, model: 'Current Model', version: 'v4.3' }
    ];

    nodes.forEach((node, index) => {
      const nodeElement = document.createElement('div');
      nodeElement.className = 'provenance-node';
      nodeElement.style.left = `${node.x}%`;
      nodeElement.style.top = `${node.y}%`;
      nodeElement.style.animationDelay = `${index * 0.2}s`;
      nodeElement.textContent = `v${node.version.split('.')[0]}`;
      
      nodeElement.addEventListener('click', () => {
        this.showProvenanceDetails(node);
      });
      
      container.appendChild(nodeElement);
    });
  }

  showProvenanceDetails(node) {
    const detailsContainer = document.getElementById('lineageInfo');
    if (!detailsContainer) return;

    detailsContainer.innerHTML = `
      <h4>${node.model}</h4>
      <p><strong>Version:</strong> ${node.version}</p>
      <p><strong>Blockchain Hash:</strong> 0x${Math.random().toString(16).substr(2, 32)}</p>
      <p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>
      <p><strong>Verification:</strong> ✅ Tamper-proof</p>
      <p><strong>Security Level:</strong> Post-Quantum</p>
    `;
  }

  updateProvenanceTimeline(value) {
    const nodes = document.querySelectorAll('.provenance-node');
    nodes.forEach((node, index) => {
      const opacity = (value / 100) * (index + 1) / nodes.length;
      node.style.opacity = opacity;
    });
  }

  // Voice Commands
  startVoiceListening() {
    const voiceStatus = document.querySelector('.voice-status');
    const voiceWave = document.querySelector('.voice-wave');
    
    if (voiceStatus) {
      voiceStatus.textContent = 'Listening...';
      voiceWave.style.animationDuration = '0.5s';
    }
    
    // Simulate voice recognition (in a real app, use Web Speech API)
    setTimeout(() => {
      if (voiceStatus) {
        voiceStatus.textContent = 'Processing command...';
      }
    }, 2000);
  }

  stopVoiceListening() {
    const voiceStatus = document.querySelector('.voice-status');
    const voiceWave = document.querySelector('.voice-wave');
    
    if (voiceStatus) {
      voiceStatus.textContent = 'Say your command...';
      voiceWave.style.animationDuration = '2s';
    }
  }

  processVoiceCommand(command) {
    const lowerCommand = command.toLowerCase();
    
    if (lowerCommand.includes('security')) {
      this.switchSection('security');
      this.showNotification('Voice Command', 'Switched to Security Analytics', 'success');
    } else if (lowerCommand.includes('carbon')) {
      this.switchSection('carbon');
      this.showNotification('Voice Command', 'Switched to Carbon Hub', 'success');
    } else if (lowerCommand.includes('model')) {
      this.switchSection('registry');
      this.showNotification('Voice Command', 'Switched to Model Registry', 'success');
    } else if (lowerCommand.includes('agent')) {
      this.switchSection('agents');
      this.showNotification('Voice Command', 'Switched to AI Orchestra', 'success');
    } else {
      this.showNotification('Voice Command', 'Command not recognized', 'warning');
    }
    
    // Update nav buttons
    const navButtons = document.querySelectorAll('.nav-btn');
    navButtons.forEach(btn => {
      btn.classList.remove('active');
      if (btn.dataset.section === this.currentSection) {
        btn.classList.add('active');
      }
    });
  }

  // Theme Toggle
  toggleTheme() {
    this.isDarkTheme = !this.isDarkTheme;
    const body = document.body;
    const themeBtn = document.querySelector('.theme-btn');
    
    if (this.isDarkTheme) {
      body.setAttribute('data-color-scheme', 'dark');
      themeBtn.textContent = '🌙';
      this.showNotification('Theme', 'Switched to Dark Theme', 'success');
    } else {
      body.setAttribute('data-color-scheme', 'light');
      themeBtn.textContent = '☀️';
      this.showNotification('Theme', 'Switched to Light Theme', 'success');
    }
  }

  // Notifications
  showNotification(title, message, type = 'info') {
    const notificationCenter = document.getElementById('notifications');
    if (!notificationCenter) return;

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    notification.innerHTML = `
      <h4>${title}</h4>
      <p>${message}</p>
    `;
    
    notificationCenter.appendChild(notification);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
      if (notification.parentNode) {
        notification.remove();
      }
    }, 5000);
  }

  // Real-time Updates
  startRealTimeUpdates() {
    // Simulate real-time data updates
    setInterval(() => {
      this.updateLiveMetrics();
      this.updateThreatLevel();
      this.simulateNewIntelligence();
    }, 10000); // Update every 10 seconds
  }

  updateLiveMetrics() {
    // Update random metrics with small variations
    const kpiCards = document.querySelectorAll('.kpi-value');
    kpiCards.forEach(card => {
      const currentValue = parseFloat(card.textContent.replace(/,/g, ''));
      const variation = (Math.random() - 0.5) * 2; // ±1 variation
      const newValue = Math.max(0, currentValue + variation);
      
      if (card.textContent.includes('.')) {
        card.textContent = newValue.toFixed(1);
      } else {
        card.textContent = Math.floor(newValue).toLocaleString();
      }
    });
  }

  updateThreatLevel() {
    const threatLevels = ['Minimal', 'Low', 'Medium'];
    const currentLevel = Math.floor(Math.random() * threatLevels.length);
    const indicator = document.querySelector('.threat-indicator span');
    const dot = document.querySelector('.indicator-dot');
    
    if (indicator && dot) {
      indicator.textContent = `Threat: ${threatLevels[currentLevel]}`;
      dot.className = `indicator-dot ${threatLevels[currentLevel].toLowerCase()}`;
    }
  }

  simulateNewIntelligence() {
    const types = ['security', 'regulatory', 'carbon', 'deepfake'];
    const randomType = types[Math.floor(Math.random() * types.length)];
    
    const newItem = {
      id: Date.now(),
      type: randomType,
      icon: '🔄',
      title: 'System Update',
      description: `Automated ${randomType} scan completed successfully`,
      timestamp: 'Just now',
      priority: 'normal',
      source: 'System Monitor'
    };
    
    this.data.intelligenceStream.unshift(newItem);
    if (this.data.intelligenceStream.length > 10) {
      this.data.intelligenceStream.pop();
    }
    
    this.populateIntelligenceStream();
    this.filterIntelligenceStream();
  }

  // Chart Updates
  updateChartTimeRange(range) {
    // Update chart data based on time range selection
    if (this.charts.performance) {
      // Simulate different data for different time ranges
      let newData;
      switch(range) {
        case '24H':
          newData = this.data.chartData.quantumPerformance;
          break;
        case '7D':
          newData = {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            security: [96.5, 97.2, 97.8, 97.5, 98.1, 97.9, 98.3],
            performance: [94.8, 95.5, 96.2, 95.9, 96.7, 96.3, 97.1],
            compliance: [98.2, 98.7, 99.1, 98.9, 99.2, 98.8, 99.4]
          };
          break;
        case '30D':
          newData = {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            security: [96.8, 97.5, 97.9, 98.2],
            performance: [95.2, 96.1, 96.4, 96.8],
            compliance: [98.5, 98.9, 99.1, 99.3]
          };
          break;
        default:
          newData = this.data.chartData.quantumPerformance;
      }
      
      this.charts.performance.data.labels = newData.labels;
      this.charts.performance.data.datasets[0].data = newData.security;
      this.charts.performance.data.datasets[1].data = newData.performance;
      this.charts.performance.data.datasets[2].data = newData.compliance;
      this.charts.performance.update();
    }
  }

  updateDeepfakeChart() {
    if (this.charts.deepfake) {
      this.charts.deepfake.update();
    }
  }

  updateCarbonChart() {
    if (this.charts.carbon) {
      this.charts.carbon.update();
    }
  }

  updateAgentNetwork() {
    if (this.charts.agentNetwork) {
      this.charts.agentNetwork.update();
    }
  }

  updateModelComparison() {
    if (this.charts.modelComparison) {
      this.charts.modelComparison.update();
    }
  }
}

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  new QuantumAINexus();
});

// Add some utility functions for enhanced interactivity
function exportData(format) {
  console.log(`Exporting data in ${format} format...`);
  // Implementation would depend on the specific format
}

function generateReport(type) {
  console.log(`Generating ${type} report...`);
  // Implementation for report generation
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case '1':
        e.preventDefault();
        document.querySelector('[data-section="command"]')?.click();
        break;
      case '2':
        e.preventDefault();
        document.querySelector('[data-section="agents"]')?.click();
        break;
      case '3':
        e.preventDefault();
        document.querySelector('[data-section="security"]')?.click();
        break;
      case '/':
        e.preventDefault();
        document.querySelector('.search-input')?.focus();
        break;
      case 'k':
        e.preventDefault();
        document.querySelector('.voice-btn')?.click();
        break;
    }
  }
  
  // ESC key to close modals
  if (e.key === 'Escape') {
    const modal = document.querySelector('.modal:not(.hidden)');
    if (modal) {
      modal.classList.add('hidden');
    }
  }
});

// Add touch gesture support for mobile
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', (e) => {
  touchStartX = e.changedTouches[0].screenX;
});

document.addEventListener('touchend', (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleGesture();
});

function handleGesture() {
  const threshold = 100;
  const diff = touchStartX - touchEndX;
  
  if (Math.abs(diff) > threshold) {
    const sections = ['command', 'agents', 'provenance', 'registry', 'security', 'carbon', 'governance', 'analytics'];
    const currentIndex = sections.indexOf(document.querySelector('.nav-btn.active')?.dataset.section);
    
    if (diff > 0 && currentIndex < sections.length - 1) {
      // Swipe left - next section
      document.querySelector(`[data-section="${sections[currentIndex + 1]}"]`)?.click();
    } else if (diff < 0 && currentIndex > 0) {
      // Swipe right - previous section
      document.querySelector(`[data-section="${sections[currentIndex - 1]}"]`)?.click();
    }
  }
}